<html class="loading" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimal-ui">
    <meta name="description" content="Kumi Team Messenger, It's modern, responsive and based on Material Design by Google.">
    <meta name="author" content="ThemeSelect">
    <title>Kumi Team Messenger</title>
    <link rel="apple-touch-icon" href="{{url_for('static', filename='images/apple-touch-icon-152x152.png')}}">
    <link rel="shortcut icon" type="image/x-icon" href="{{url_for('static', filename='images/favicon-32x32.png')}}">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
          integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!-- Import Material Google Icon Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Custom Google Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Raleway:400,700&display=swap" rel="stylesheet">
    <!-- Materialize.css CDN-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Page Level CSS
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/materialize.min.css')}}">-->
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/vendors.min.css')}}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/style.min.css')}}">
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/app-chat.min.css')}}">
    <!-- Custom CSS-->
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/custom.css')}}">
    <!-- Animate CSS-->
    <link rel="stylesheet" href="{{url_for('static', filename='css/animate.css')}}">
    <style>
        html, body {margin: 0; height: 100%; overflow: hidden}
        body {
            /* Disables pull-to-refresh but allows overscroll glow effects. */
            overscroll-behavior-y: none;
        }
        .chat-area {
            background-image: url({{url_for('static', filename='images/bg/shattered.png')}})
        }
        .bg-image-arches {
            background-color: #ff8a65;
            background-image: url({{url_for('static', filename='images/bg/arches.png')}})
        }
        .bg-image-brick-wall-dark {
            background-color: #9e9e9e;
            background-image: url({{url_for('static', filename='images/bg/brick-wall-dark.png')}})
        }
        .bg-image-gradient-squares {
            background-color: #a1887f;
            background-image: url({{url_for('static', filename='images/bg/gradient-squares.png')}})
        }
        .bg-image-foggy-birds {
            background-color: #01579b;
            background-image: url({{url_for('static', filename='images/bg/foggy-birds.png')}})
        }
        .bg-image-swirl {
            background-color: #607d8b;
            background-image: url({{url_for('static', filename='images/bg/swirl.png')}})
        }
        .bg-image-hexellence {
            background-color: #a1887f;
            background-image: url({{url_for('static', filename='images/bg/hexellence.png')}})
        }
        .bg-image-inspiration-geometry {
            background-color: #616161;
            background-image: url({{url_for('static', filename='images/bg/inspiration-geometry.png')}})
        }
        .bg-image-shattered {
            background-image: url({{url_for('static', filename='images/bg/shattered.png')}})
        }
        .bg-image-flowers {
            background-color: #ab47bc;
            background-image: url({{url_for('static', filename='images/bg/flowers.png')}})
        }

        .bg-image-light-wool {
            background-color: #aed581;
            background-image: url({{url_for('static', filename='images/bg/light-wool.png')}})
        }
        .bg-image-gray-floral {
            background-color: #e57373  ;
            background-image: url({{url_for('static', filename='images/bg/gray-floral.png')}})
        }
        .bg-image-beige-paper {
            background-color: #b3e5fc ;
            background-image: url({{url_for('static', filename='images/bg/beige-paper.png')}})
        }
        .bg-image-padded-light {
            background-color: #8d6e63;
            background-image: url({{url_for('static', filename='images/bg/padded-light.png')}})
        }
        .bg-image-pool-table {
            background-color: #1b5e20;
            background-image: url({{url_for('static', filename='images/bg/pool-table.png')}})
        }
        .bg-image-skulls {
            background-color: #757575;
            background-image: url({{url_for('static', filename='images/bg/skulls.png')}})
        }
        .bg-image-xv {
            background-color: #00695c;
            background-image: url({{url_for('static', filename='images/bg/xv.png')}})
        }
        .bg-image-type {
            background-color: #b2ebf2 ;
            background-image: url({{url_for('static', filename='images/bg/type.png')}})
        }
        .bg-image-purty-wood {
            background-color: #d7ccc8       ;
            background-image: url({{url_for('static', filename='images/bg/purty-wood.png')}})
        }

        .span-time  {
            text-align: center;
        }
        .span-time-right{
            position: relative;
            right: 10px;
        }

        .chat-body:hover .span-time-right  {
            display: block;
        }

        .chat-body:hover .span-time {
            display: block;
        }

        .unselectable {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .slide-out-right-sidenav-chat {
          height: 100%;
          width: 100%;
        }

        .slide-out-right-sidenav-chat canvas {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          border: 1px solid black;
        }

        .opt-text {
            visibility: hidden;
            position: relative;
            right: 6px;
        }

        .line-option:hover .opt-text {
            visibility: visible;
        }

        #chat-input .file-load {
            display: none;
        }

        .chat-area .uploading-file {
            display: none;
        }

        .chat-area .attachment-clear {
            display: none;
        }

        .chat-area .attachment-clear {
            display: none;
        }
    </style>
</head>
<!-- END: Head-->
<body class="vertical-layout vertical-menu-collapsible page-header-dark vertical-modern-menu preload-transitions 2-columns app-page" data-open="click" data-menu="vertical-modern-menu" data-col="2-columns">

    <!-- BEGIN: Header-->
    <header class="page-topbar" id="header">
        <div class="navbar navbar-fixed">
            <nav class="navbar-main navbar-color nav-collapsible sideNav-lock navbar-dark no-shadow">
                <div class="nav-wrapper">
                    <div class="header-search-wrapper hide-on-med-and-down">
                        <i class="material-icons">search</i>
                        <input class="header-search-input z-depth-2" type="text" name="Search" placeholder="Search" data-search="template-list">
                        <ul class="search-list collection display-none"></ul>
                    </div>
                    <ul class="navbar-list right">
                        <li><a class="waves-effect waves-block waves-light sidenav-trigger tabs-activate" href="activity" data-target="slide-out-right"><i class="material-icons">assignment<small class="notification-badge orange">2</small></i></a></li>
                        <li><a class="waves-effect waves-block waves-light sidenav-trigger tabs-activate" href="Friends" data-target="slide-out-right"><i class="fas fa-user-check"><small class="notification-badge orange friend-online-counter hide">0</small></i></a></li>
                        <li><a class="waves-effect waves-block waves-light sidenav-trigger tabs-activate" href="Members" data-target="slide-out-right"><i class="fas fa-users"><small class="notification-badge orange online-counter hide">0</small></i></a></li>
                        <li class="hide-on-med-and-down"><a class="waves-effect waves-block waves-light toggle-fullscreen" href="javascript:void(0);"><i class="material-icons">settings_overscan</i></a></li>
                        <!--
                        <li class="hide-on-large-only search-input-wrapper"><a class="waves-effect waves-block waves-light search-button" href="javascript:void(0);"><i class="material-icons">search</i></a></li>
                        <li><a class="waves-effect waves-block waves-light notification-button" href="javascript:void(0);" data-target="notifications-dropdown"><i class="material-icons">notifications_none<small class="notification-badge">5</small></i></a></li>
                        <li><a class="waves-effect waves-block waves-light profile-button" href="javascript:void(0);" data-target="profile-dropdown"><span class="avatar-status avatar-online"><img src="{{url_for('static', filename='images/avatar/avatar-13.png')}}" alt="avatar"><i></i></span></a></li>
                        <li><a class="waves-effect waves-block waves-light sidenav-trigger" href="#" data-target="slide-out-right"><i class="material-icons">format_indent_increase</i></a></li>-->
                    </ul>
                    <!-- attachment-dropdown-->
                    <ul class="dropdown-content black-text" id="attachment-dropdown" style="min-width: 250px;">
                        <form method="POST" enctype="multipart/form-data" id="fileUploadForm">
                            <li class="hide-on-med-and-down">
                                <span>Attach a File:</span>
                            </li>
                            <li class="hide-on-large-only"><a class="black-text" href="javascript:editorCmd('bold');"><span class="material-icons">format_bold</span> Bold</a></li>
                            <li class="hide-on-large-only"><a class="black-text" href="javascript:editorCmd('italic');"><span class="material-icons">format_italic</span> Italic</a></li>
                            <li class="hide-on-large-only"><a class="black-text" href="javascript:editorCmd('underline');"><span class="material-icons">format_underlined</span> Underline</a></li>
                            <li class="divider"></li>
                            <li id="file-upload-tigger">
                                <a class="black-text" href="#!">
                                    <input type="file" id="file-upload" name="file-upload" style="display: none;">
                                    <span class="material-icons icon-bg-circle deep-orange small">insert_drive_file</span> System File
                                </a>
                            </li>
                            <li>
                                <a class="grey-text" href="#!"><span class="icon-bg-circle cyan small"><i class="fab fa-google-drive"></i></span> Google Drive</a>
                            </li>
                            <li>
                                <a class="grey-text" href="#!"><span class="icon-bg-circle black small"><i class="fab fa-github"></i></span> GitHub</a>
                            </li>
                            <li>
                                <a class="grey-text" href="#!"><span class="icon-bg-circle blue small"><i class="fab fa-dropbox"></i></span> DropBox</a>
                            </li>
                        </form>
                    </ul>
                    <!--profile-dropdown-->
                    <ul class="dropdown-content" id="profile-dropdown">
                        <li data-value="0"><a class="grey-text text-darken-1" href="#"><i class="material-icons green-text">fiber_manual_record</i> Online</a></li>
                        <li data-value="1"><a class="grey-text text-darken-1" href="#"><i class="material-icons red-text">fiber_manual_record</i> Busy</a></li>
                        <li data-value="2"><a class="grey-text text-darken-1" href="#"><i class="material-icons yellow-text">fiber_manual_record</i> Away</a></li>
                    </ul>
                    <!--pen-dropdown-->
                    <ul class="dropdown-content" id="pen-dropdown" style="max-width: 30px;">
                        <li><span class="change-type black-text"><i class="material-icons">brush</i></span></li>
                        <li><span class="change-type amber-text text-lighten-2"><i class="material-icons">call_to_action</i></span></li>
                        <li class="divider"></li>
                        <li><span class="change-color black-text" data-color="black"><i class="material-icons">lens</i></span></li>
                        <li><span class="change-color blue-text" data-color="blue"><i class="material-icons">lens</i></span></li>
                        <li><span class="change-color red-text" data-color="red"><i class="material-icons">lens</i></span></li>
                        <li><span class="change-color green-text" data-color="green"><i class="material-icons">lens</i></span></li>
                    </ul>
                    <!--image-dropdown-->
                    <ul class="dropdown-content" id="image-dropdown">
                        <li>
                            <span>
                                <input type="file" id="file" accept="image/*;capture=camera" style="display: none;">
                                <label for="file">
                                    <i class="material-icons vertical-text-middle"><a class="waves-effect">image</a></i>
                                </label>
                            </span>
                        </li>
                        <li><span class="black-text image-new"><i class="material-icons">layers_clear</i></span></li>
                    </ul>
                    <!--chat-option-dropdown-->
                    <ul class="dropdown-content" id="chat-option-dropdown">
                        {% if current_user.admin_level == 0 %}
                        <li><a class="black-text modal-trigger" href="#suspend-modal"><i class="material-icons">layers_clear</i> Suspension</a></li>{% endif %}
                    </ul>
                </div>
                <nav class="display-none search-sm">
                    <div class="nav-wrapper">
                        <form id="navbarForm">
                            <div class="input-field search-input-sm">
                                <input class="search-box-sm mb-0" type="search" required="" id="search" placeholder="Explore Materialize" data-search="template-list">
                                <label class="label-icon" for="search"><i class="material-icons search-sm-icon">search</i></label><i class="material-icons search-sm-close">close</i>
                                <ul class="search-list collection search-list-sm display-none"></ul>
                            </div>
                        </form>
                    </div>
                </nav>
            </nav>
        </div>
    </header>
    <!-- END: Header-->
    <ul class="display-none" id="default-search-main">
        <li class="auto-suggestion-title">
            <a class="collection-item" href="#">
                <h6 class="search-title">FILES</h6>
            </a>
        </li>
        <li class="auto-suggestion">
            <a class="collection-item" href="#">
                <div class="display-flex">
                    <div class="display-flex align-item-center flex-grow-1">
                        <div class="avatar"><img src="{{url_for('static', filename='images/icon/pdf-image.png')}}" width="24" height="30" alt="sample image"></div>
                        <div class="member-info display-flex flex-column"><span class="black-text">Final report</span><small class="grey-text">Marketing Manager</small></div>
                    </div>
                    <div class="status"><small class="grey-text">17kb</small></div>
                </div>
            </a>
        </li>
        <li class="auto-suggestion">
            <a class="collection-item" href="#">
                <div class="display-flex">
                    <div class="display-flex align-item-center flex-grow-1">
                        <div class="avatar"><img src="{{url_for('static', filename='images/icon/doc-image.png')}}" width="24" height="30" alt="sample image"></div>
                        <div class="member-info display-flex flex-column"><span class="black-text">Editable Report Document</span><small class="grey-text">FontEnd Developer</small></div>
                    </div>
                    <div class="status"><small class="grey-text">550kb</small></div>
                </div>
            </a>
        </li>
        <li class="auto-suggestion">
            <a class="collection-item" href="#">
                <div class="display-flex">
                    <div class="display-flex align-item-center flex-grow-1">
                        <div class="avatar"><img src="{{url_for('static', filename='images/icon/xls-image.png')}}" width="24" height="30" alt="sample image"></div>
                        <div class="member-info display-flex flex-column"><span class="black-text">Traceability Matrix Sheet</span><small class="grey-text">Digital Marketing Manager</small></div>
                    </div>
                    <div class="status"><small class="grey-text">20kb</small></div>
                </div>
            </a>
        </li>
        <li class="auto-suggestion-title">
            <a class="collection-item" href="#">
                <h6 class="search-title">MEMBERS</h6>
            </a>
        </li>
        {% for member in members %}
        <li class="auto-suggestion">
            <a class="collection-item" href="#">
                <div class="display-flex">
                    <div class="display-flex align-item-center flex-grow-1">
                        <div class="avatar"><img class="circle" src="{{url_for('static', filename='images/avatar/'+member.imgUrl)}}" width="30" alt="sample image"></div>
                        <div class="member-info display-flex flex-column"><span class="black-text">{{member.fullname}}</span><small class="grey-text">{{member.title}}</small></div>
                    </div>
                </div>
            </a>
        </li>
        {% endfor %}
    </ul>
    <ul class="display-none" id="page-search-title">
        <li class="auto-suggestion-title">
            <a class="collection-item" href="#">
                <h6 class="search-title">PAGES</h6>
            </a>
        </li>
    </ul>
    <ul class="display-none" id="search-not-found">
        <li class="auto-suggestion"><a class="collection-item display-flex align-items-center" href="#"><span class="material-icons">error_outline</span><span class="member-info">No results found.</span></a></li>
    </ul>



    <!-- BEGIN: SideNav-->
    <aside class="sidenav-main nav-expanded nav-lock nav-collapsible sidenav-active-square">
        <div class="brand-sidebar">
            <h1 class="logo-wrapper">
                <a class="brand-logo darken-1" href="/">
                    <img class="hide-on-med-and-down" src="{{url_for('static', filename='images/kumi-logo.png')}}" alt="materialize logo" />
                    <img class="show-on-medium-and-down hide-on-med-and-up" src="{{url_for('static', filename='images/kumi-logo.png')}}" alt="materialize logo" />
                    <span class="logo-text hide-on-med-and-down">Kumi</span>
                </a>
                <a class="navbar-toggler" href="#"><i class="material-icons">radio_button_checked</i></a>
            </h1>
        </div>
        <ul class="sidenav sidenav-collapsible leftside-navigation collapsible sidenav-fixed menu-shadow" id="slide-out" data-menu="menu-navigation" data-collapsible="menu-accordion">
            <li class="bold member_{{ current_user.id }}">
                <a class="waves-effect profile-button" href="#" data-target="profile-dropdown"><i><span class="avatar-status avatar-{{ current_user.online_status }}"><img src="{{url_for('static', filename='images/avatar/'+current_user.imgUrl)}}" alt="avatar"><i></i></span></i><span class="menu-title" data-i18n="Support">{{ current_user.fullname }}</span></a>
            </li>
            <li class="bold hide-on-med-and-down"><a class="waves-effect waves-block waves-light sidenav-trigger tabs-activate" href="activity" data-target="slide-out-right"><i class="material-icons">assignment</i><span class="menu-title" data-i18n="Tasks" data-target="slide-out-right">Tasks</span><span class="badge badge pill orange float-right mr-10">2</span></a></li>

            <!-- Channels -->
            <li class="navigation-header"><a class="navigation-header-text">Channels</a><i class="navigation-header-icon material-icons">more_horiz</i></li>
            {% for channel in all_channels %}
            <li class="bold">
                <a class="waves-effect waves-cyan open-chat {{channel.active}} gradient-shadow hide channel-item" href="#" data-id="{{channel.id}}" data-link="{{channel.b64name}}" data-type="menu"><i class="material-icons blue-text">chat_bubble_outline</i><span class="menu-title" data-i18n="Chat">{{channel.name}}</span></a>
            </li>
            {% endfor %}

            <!--<li class="bold">
        <a class="collapsible-header waves-effect waves-cyan " href="JavaScript:void(0)"><i class="material-icons">format_list_bulleted</i><span class="menu-title" data-i18n="Dashboard">More</span><span class="badge badge pill orange float-right mr-10">3</span></a>
        <div class="collapsible-body">
            <ul class="collapsible collapsible-sub" data-collapsible="accordion">

                <li class="bold">
                    <a class="waves-effect waves-cyan" href="#"><i class="material-icons orange-text">lock_outline</i><span class="menu-title" data-i18n="Chat">#Design-Team</span></a>
                </li>
                <li class="bold">
                    <a class="waves-effect waves-cyan" href="#"><i class="material-icons orange-text">lock_outline</i><span class="menu-title" data-i18n="Chat">#Marketing-Team</span></a>
                </li>
                <li class="bold">
                    <a class="waves-effect waves-cyan" href="#"><i class="material-icons orange-text">lock_outline</i><span class="menu-title" data-i18n="Chat">#Human-Resources</span></a>
                </li>
            </ul>
        </div>
    </li>-->
            <!-- Direct Message -->
            <li class="navigation-header">
                <a class="navigation-header-text">Direct Message</a><i class="navigation-header-icon material-icons">more_horiz</i>
            </li>
            {% for friend in members %}
            {% if friend.id != current_user.id %}
            <li id="member_{{friend.id}}" class="bold member_{{friend.id}} hide">
                <a id="sidenav_m{{friend.id}}" class="waves-effect waves-cyan open-chat gradient-shadow" href="#" data-link="{{friend.b64name}}" data-id="{{friend.id}}" data-type="menu"><i><span class="avatar-status avatar-off"><img src="{{url_for('static', filename='images/avatar/'+friend.imgUrl)}}" alt="avatar"><i></i></span></i><span class="menu-title">{{friend.fullname}} </span></a>
            </li>
            {% endif %}
            {% endfor %}

            <!-- Contacts -->
            <li class="navigation-header hide-on-small-only">
                <a class="navigation-header-text">CONTACTS </a><i class="navigation-header-icon material-icons">more_horiz</i>
            </li>
            <li class="bold hide-on-small-only"><a class="waves-effect waves-block waves-light sidenav-trigger tabs-activate" href="Friends" data-target="slide-out-right"><i class="fas fa-user-check green-text"></i><span class="menu-title" data-i18n="Friends" data-target="slide-out-right">Friends</span><span class="badge badge pill orange float-right mr-10 friend-online-counter hide">0</span></a></li>
            <li class="bold hide-on-small-only"><a class="waves-effect waves-block waves-light sidenav-trigger tabs-activate" href="Members" data-target="slide-out-right"><i class="fas fa-users"></i><span class="menu-title" data-i18n="Members" data-target="slide-out-right">Members</span><span class="badge badge pill orange float-right mr-10 online-counter hide">0</span></a></li>

            <!-- Misc -->
            <li class="navigation-header">
                <a class="navigation-header-text">Misc </a><i class="navigation-header-icon material-icons">more_horiz</i>
            </li>
            <li class="bold"><a class="waves-effect waves-cyan sidenav-trigger" href="JavaScript:void(0)" data-target="theme-cutomizer-out"><i class="material-icons">chrome_reader_mode</i><span class="menu-title" data-i18n="Support">Theme</span></a></li>
            {% if current_user.admin_level == 0 %}
            <li class="bold">
                <a class="collapsible-header waves-effect waves-cyan " href="JavaScript:void(0)"><i class="material-icons">format_list_bulleted</i><span class="menu-title" data-i18n="Dashboard">Admin Options</span></a>
                <div class="collapsible-body">
                    <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                        <li class="bold"><a class="waves-effect waves-cyan modal-trigger" href="JavaScript:void(0)" data-target="manage-channel-modal"><i class="material-icons">dashboard</i><span class="menu-title" data-i18n="Support">Channel Manager</span></a></li>
                        <li class="bold"><a class="waves-effect waves-cyan" href="/db" target="_blank"><i class="material-icons">filter_drama</i><span class="menu-title" data-i18n="Support">Database Viewer</span></a></li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <li><a class="waves-effect waves-block waves-light" href="/logout"><i class="material-icons">keyboard_tab</i><span class="menu-title" data-i18n="Support">Logout<span></a></li>
        </ul>
        <div class="navigation-background"></div><a class="sidenav-trigger btn-sidenav-toggle btn-floating btn-medium waves-effect waves-light hide-on-large-only" href="#" data-target="slide-out"><i class="material-icons">menu</i></a>
    </aside>
    <!-- END: SideNav-->
    <!-- BEGIN: Page Main-->
    <div id="main">
        <div class="row">
            <div class="content-wrapper-before"></div>
            <div class="col s12">
                <div class="container">
                    <div class="chat-application">
                        <div class="app-chat">
                            <div class="content-area content-right">
                                <div class="app-wrapper">
                                    <!-- Sidebar menu for small screen
                                    <a href="#" data-target="chat-sidenav" class="sidenav-trigger hide-on-large-only">
                                        <i class="material-icons">menu</i>
                                    </a>
                                    Sidebar menu for small screen -->

                                    <div class="card card card-default scrollspy border-radius-6 fixed-width">
                                        <div class="card-content chat-content p-0">

                                            <!-- Content Area -->
                                            <div class="chat-content-area animate fadeUp">
                                                <!-- Chat header -->
                                                <div class="chat-header">
                                                    <div class="row valign-wrapper">
                                                        <div class="col media-image online pr-0">
                                                            <img src="{% if current_channel[0] %}{{url_for('static', filename='images/avatar/'+current_channel[0].imgUrl)}}{% endif %}" alt="" class="circle z-depth-2 responsive-img white" id="chat-avatar">
                                                        </div>
                                                        <div class="col chat-content-header">
                                                            <p class="m-0 font-weight-700" id="chat-name">{% if current_channel[0] %}{{ current_channel[0].name }}{% endif %}</p>
                                                            <p class="m-0 truncate" style="font-size: x-small" id="chat-subtext">{% if current_channel[0] %}{{ current_channel[0].title }}{% endif %}</p>
                                                        </div>
                                                    </div>
                                                    <span class="option-icon">
                                                        <span class="hide" id="chat-add-friend" data-id="">
                                                            <i class="material-icons">person_add</i>
                                                        </span>
                                                        <span class="sidenav-trigger tabs-activate hide-on-med-and-down" data-target="slide-out-chat"><i class="material-icons">launch</i></span>
                                                        {% if current_user.admin_level == 0 %}<i class="material-icons notification-button" data-target="chat-option-dropdown" id="chat-options">more_vert</i>{% endif %}
                                                        <!--<i class="material-icons hide-on-med-and-down hide" id="chat-delete">delete</i>-->
                                                    </span>
                                                </div>
                                                <!--/ Chat header -->
                                                <!-- Chat content area -->
                                                <div class="chat-area">
                                                    <div class="chats" id="chat-area">

                                                    </div>
                                                </div>
                                                <!--/ Chat content area -->
                                                <!-- Chat footer <-->
                                                <div class="chat-footer">
                                                    <form onsubmit="enter_chat();" action="javascript:void(0);" class="chat-input" autocomplete="off" enctype="multipart/form-data">
                                                        <!--<i class="mr-2 hide-on-med-and-up"><a class="waves-effect waves-block waves-light chat-input-tool notification-button" href="javascript:void(0);" data-target="chat-options-dropdown"><i class="material-icons mr-2">arrow_drop_down_circle</i></a></i>-->
                                                        <i class="mr-2">
                                                            <a class="waves-effect waves-block waves-light notification-button" href="javascript:void(0);" data-target="attachment-dropdown">
                                                                <i class="material-icons mr-2 hide-on-med-and-down">attachment</i>
                                                                <i class="material-icons mr-2 hide-on-large-only">arrow_drop_down_circle</i>
                                                            </a>
                                                        </i>
                                                        <i class="mr-2 hide-on-med-and-down"><a class="waves-effect waves-block waves-light chat-input-tool" href="javascript:void(0);" id="emoji-button"><i class="material-icons mr-2">face</i></a></i>

                                                        <i class="mr-2 hide-on-med-and-down"><a class="waves-effect waves-block waves-light" href="javascript:editorCmd('bold');"><i class="material-icons mr-2">format_bold</i></a></i>
                                                        <i class="mr-2 hide-on-med-and-down"><a class="waves-effect waves-block waves-light" href="javascript:editorCmd('italic');"><i class="material-icons mr-2">format_italic</i></a></i>
                                                        <i class="mr-2 hide-on-med-and-down"><a class="waves-effect waves-block waves-light" href="javascript:editorCmd('underline');"><i class="material-icons mr-2">format_underlined</i></a></i>
                                                        <div type="text" data-text="Type message here.." class="message grey-text text-darken-2 mb-0" id="chat-input" contentEditable=true></div>
                                                        <a class="btn waves-effect waves-light send" onclick="enter_chat();">Send</a>
                                                    </form>
                                                </div>
                                                <!--/ Chat footer -->
                                            </div>
                                            <!--/ Content Area -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- START RIGHT SIDEBAR NAV -->
                    <aside id="right-sidebar-nav">
                        <div id="slide-out-right" class="slide-out-right-sidenav sidenav rightside-navigation">
                            <div class="row">
                                <div class="slide-out-right-title">
                                    <div class="col s12 border-bottom-1 pb-0 pt-1">
                                        <div class="row">
                                            <div class="col s2 pr-0 center">
                                                <i class="material-icons vertical-text-middle"><a href="#" class="sidenav-close">clear</a></i>
                                            </div>
                                            <div class="col s10 pl-0">
                                                <ul class="tabs">
                                                    <li class="tab col s4 p-0">
                                                        <a href="#Friends">
                                                            <span>Friends</span>
                                                        </a>
                                                    </li>
                                                    <li class="tab col s4 p-0">
                                                        <a href="#Members" class="active">
                                                            <span>Members</span>
                                                        </a>
                                                    </li>
                                                    <li class="tab col s4 p-0">
                                                        <a href="#activity">
                                                            <span>Tasks</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slide-out-right-body row pl-3">
                                    <div id="Members" class="col s12 pb-0 messages">
                                        <div class="collection border-none mb-0">
                                            <input class="header-search-input mt-4 mb-2" type="text" name="Search" placeholder="Search" autocomplete="off" />
                                            <ul class="collection right-sidebar-chat p-0 mb-0 unselectable" id="members_ul">
                                                {% for member in members %}
                                                {% if member.id != current_user.id %}
                                                <li class="open-chat collection-item right-sidebar-chat-item display-flex avatar pl-5 pb-0 member_{{member.id}}" data-target="slide-out-chat" data-position="3" data-link="{{member.b64name}}" data-id="{{member.id}}">
                                                    <span class="avatar-status avatar-off avatar-50">
                                                        <img src="{{url_for('static', filename='images/avatar/'+member.imgUrl)}}" alt="avatar" />
                                                        <i></i>
                                                    </span>
                                                    <div class="user-content">
                                                        <h6 class="line-height-0">{{member.fullname}}</h6>
                                                        <p class="medium-small grey-text pt-3">{{member.title}}</p>
                                                    </div>
                                                    <!--<span class="secondary-content medium-small">...</span>-->
                                                </li>
                                                {% endif %}
                                                {% endfor %}
                                            </ul>
                                            <br /><br /><br />
                                        </div>
                                    </div>
                                    <div id="Friends" class="col s12 pb-0 messages">
                                        <div class="collection border-none mb-0">
                                            <input class="header-search-input mt-4 mb-2" type="text" name="Search" placeholder="Search" autocomplete="off" />
                                            <ul class="collection right-sidebar-chat p-0 mb-0 unselectable" id="friends_ul">
                                                {% for member in members %}
                                                <li id="friend_{{member.id}}" class="open-chat collection-item right-sidebar-chat-item display-flex avatar pl-5 pb-0 member_{{member.id}}" data-link="{{member.b64name}}" data-target="slide-out-chat" data-position="3" data-id="{{member.id}}">
                                                    <span class="avatar-status avatar-off avatar-50">
                                                        <img src="{{url_for('static', filename='images/avatar/'+member.imgUrl)}}" alt="avatar" />
                                                        <i></i>
                                                    </span>
                                                    <div class="user-content">
                                                        <h6 class="line-height-0">{{member.fullname}}</h6>
                                                        <p class="medium-small grey-text pt-3">{{member.title}}</p>
                                                    </div>
                                                    <!--<span class="secondary-content medium-small">Just now</span>-->
                                                </li>
                                                {% endfor %}
                                            </ul>
                                            <br /><br /><br />
                                        </div>
                                    </div>
                                    <div id="activity" class="col s12">
                                        <div class="activity">
                                            <p class="mt-5 mb-0 ml-5 font-weight-900">PENDING TASKS</p>
                                            <ul class="widget-timeline mb-0">
                                                <li class="timeline-items timeline-icon-blue active">
                                                    <div class="timeline-time">3 days</div>
                                                    <h6 class="timeline-title">UI Design</h6>
                                                    <p class="timeline-text">This task is assigned to Daniel</p>
                                                    <div class="timeline-content blue-text">Urgent</div>
                                                </li>
                                                <li class="timeline-items timeline-icon-orange active">
                                                    <div class="timeline-time">4 weeks</div>
                                                    <h6 class="timeline-title">High Fidelity Prototyping</h6>
                                                    <p class="timeline-text">This task is assigned to Tai and Tatsuya</p>
                                                    <div class="timeline-content orange-text">Pending</div>
                                                </li>
                                            </ul>
                                            <p class="mt-5 mb-0 ml-5 font-weight-900">ACTION REQUIRED</p>
                                            <ul class="widget-timeline mb-0">
                                                <li class="timeline-items timeline-icon-orange active">
                                                    <div class="timeline-time">Just now</div>
                                                    <h6 class="timeline-title">New task assigned</h6>
                                                    <p class="timeline-text">Need to intergate backlog #16.4</p>
                                                    <div class="timeline-content orange-text">Pending Review</div>
                                                </li>
                                                <li class="timeline-items timeline-icon-red active">
                                                    <div class="timeline-time">20 mins</div>
                                                    <h6 class="timeline-title">Database overloaded 89%</h6>
                                                    <p class="timeline-text">Database report auto-generated.</p>
                                                    <div class="timeline-content">
                                                        <img src="{{url_for('static', filename='images/icon/pdf.png')}}" alt="document" height="30" width="25"
                                                             class="mr-1">Database-log.doc
                                                    </div>
                                                    <div class="timeline-content red-text">Important</div>
                                                </li>
                                                <li class="timeline-items timeline-icon-blue active">
                                                    <div class="timeline-time">50 mins</div>
                                                    <h6 class="timeline-title">System restart needed</h6>
                                                    <p class="timeline-text">Heroku will auto-deploy latest commit of the master branch upon system restart</p>
                                                    <div class="timeline-content blue-text">Urgent</div>
                                                </li>
                                                <li class="timeline-items timeline-icon-orange active">
                                                    <div class="timeline-time">5 hrs</div>
                                                    <h6 class="timeline-title">Low Fidelity Prototyping</h6>
                                                    <p class="timeline-text">Anish hand-drawn design concepts.</p>
                                                    <div class="timeline-content orange-text">Pending Review</div>
                                                </li>
                                            </ul>
                                            <p class="mt-5 mb-0 ml-5 font-weight-900">DOCUMENTS</p>
                                            <ul class="widget-timeline mb-0">
                                                <li class="timeline-items timeline-icon-indigo active">
                                                    <div class="timeline-time">30 mins</div>
                                                    <h6 class="timeline-title">12 new users registered</h6>
                                                    <p class="timeline-text">Registration report auto-generated.</p>
                                                    <div class="timeline-content">
                                                        <img src="{{url_for('static', filename='images/icon/pdf.png')}}" alt="document" height="30" width="25"
                                                             class="mr-1">Registration_report.pdf
                                                    </div>
                                                </li>
                                                <li class="timeline-items timeline-icon-indigo active">
                                                    <div class="timeline-time">5 days</div>
                                                    <h6 class="timeline-title">Jacob completed the personas report</h6>
                                                    <p class="timeline-text">We also used personas to guide when we pitched our solution</p>
                                                    <div class="timeline-content">
                                                        <img src="{{url_for('static', filename='images/icon/pdf.png')}}" alt="document" height="30" width="25"
                                                             class="mr-1">personas_report.pdf
                                                    </div>
                                                </li>
                                            </ul>
                                            <p class="mt-5 mb-0 ml-5 font-weight-900">COMPLETED TASKS</p>
                                            <ul class="widget-timeline mb-0">
                                                <li class="timeline-items timeline-icon-green active">
                                                    <div class="timeline-time">10 days</div>
                                                    <h6 class="timeline-title">Data Flow Diagram</h6>
                                                    <p class="timeline-text">Assigned to Tatsuya</p>
                                                    <div class="timeline-content green-text">Completed</div>
                                                </li>
                                                <li class="timeline-items timeline-icon-green">
                                                    <div class="timeline-time">10 days</div>
                                                    <h6 class="timeline-title">UI Transition Diagram</h6>
                                                    <p class="timeline-text">Assigned to Daniel</p>
                                                    <div class="timeline-content green-text">Completed</div>
                                                </li>
                                            </ul>
                                            <br><br><br>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Slide Out Chat -->
                        <div id="slide-out-chat" class="sidenav slide-out-right-sidenav-chat">
                            <canvas id="imageCanvas"></canvas>
                            <canvas id="whiteboard"></canvas>
                            <div class="row z-depth-2 align-right" style="z-index: 1000; position: absolute; background: white !important">
                                <div class="slide-out-right-title" onselectstart="return false;">
                                    <div class="col s12 border-bottom-1 pb-0 pt-1">
                                        <div class="row">
                                            <div class="col s12">
                                                <i class="material-icons vertical-text-middle"><a href="#" class="sidenav-close">clear</a></i>
                                                WHITEBOARD
                                                <i class="material-icons vertical-text-middle">navigate_next</i>
                                                <i class="material-icons vertical-text-middle"><a href="#" class="notification-button" data-target="image-dropdown" style="color: black">image</a></i>
                                                <i class="material-icons vertical-text-middle">navigate_next</i>
                                                <i class="material-icons vertical-text-middle"><a href="#" id="change-type" class="notification-button" data-target="pen-dropdown" style="color: black">brush</a></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </div>
    </div>
    <!-- END: Page Main-->
    <!-- Theme Customizer -->
    <div id="theme-cutomizer-out" class="theme-cutomizer sidenav row">
        <div class="col s12">
            <a class="sidenav-close" href="#!"><i class="material-icons">close</i></a>
            <h5 class="theme-cutomizer-title grey-text">Theme</h5>
            <div class="menu-options">
                <hr class="customize-devider" />
                <h6 class="mt-6 grey-text">Colors:</h6>
                <div class="menu-options-form row">
                    <div class="input-field col s12 menu-color mb-0">
                        <div class="gradient-color center-align">
                            <span class="menu-color-option gradient-45deg-indigo-blue"
                                  data-color="gradient-45deg-indigo-blue" id="gradient-45deg-indigo-blue"></span>
                            <span class="menu-color-option gradient-45deg-purple-deep-orange"
                                  data-color="gradient-45deg-purple-deep-orange" id="gradient-45deg-purple-deep-orange"></span>
                            <span class="menu-color-option gradient-45deg-light-blue-cyan"
                                  data-color="gradient-45deg-light-blue-cyan" id="gradient-45deg-light-blue-cyan"></span>
                            <span class="menu-color-option gradient-45deg-purple-amber"
                                  data-color="gradient-45deg-purple-amber" id="gradient-45deg-purple-amber"></span>
                            <span class="menu-color-option gradient-45deg-purple-deep-purple"
                                  data-color="gradient-45deg-purple-deep-purple" id="gradient-45deg-purple-deep-purple"></span>
                            <span class="menu-color-option gradient-45deg-deep-orange-orange"
                                  data-color="gradient-45deg-deep-orange-orange" id="gradient-45deg-deep-orange-orange"></span>
                            <span class="menu-color-option gradient-45deg-green-teal" data-color="gradient-45deg-green-teal" id="gradient-45deg-green-teal"></span>
                            <span class="menu-color-option gradient-45deg-indigo-light-blue"
                                  data-color="gradient-45deg-indigo-light-blue" id="gradient-45deg-indigo-light-blue"></span>
                            <span class="menu-color-option gradient-45deg-red-pink" data-color="gradient-45deg-red-pink" id="gradient-45deg-red-pink"></span>
                        </div>
                        <!--<div class="solid-color center-align">
                            <span class="menu-color-option red" data-color="red"></span>
                            <span class="menu-color-option purple" data-color="purple"></span>
                            <span class="menu-color-option pink" data-color="pink"></span>
                            <span class="menu-color-option deep-purple" data-color="deep-purple"></span>
                            <span class="menu-color-option cyan" data-color="cyan"></span>
                            <span class="menu-color-option teal" data-color="teal"></span>
                            <span class="menu-color-option light-blue" data-color="light-blue"></span>
                            <span class="menu-color-option amber darken-3" data-color="amber darken-3"></span>
                            <span class="menu-color-option brown darken-2" data-color="brown darken-2"></span>
                        </div>-->
                    </div>
                    <div class="input-field col s12 menu-bg-color mb-0">
                        <p class="mt-0">Menu Background Color</p>
                        <div class="gradient-color center-align">
                            <span class="menu-bg-color-option gradient-45deg-indigo-blue"
                                  data-color="gradient-45deg-indigo-blue"></span>
                            <span class="menu-bg-color-option gradient-45deg-purple-deep-orange"
                                  data-color="gradient-45deg-purple-deep-orange"></span>
                            <span class="menu-bg-color-option gradient-45deg-light-blue-cyan"
                                  data-color="gradient-45deg-light-blue-cyan"></span>
                            <span class="menu-bg-color-option gradient-45deg-purple-amber"
                                  data-color="gradient-45deg-purple-amber"></span>
                            <span class="menu-bg-color-option gradient-45deg-purple-deep-purple"
                                  data-color="gradient-45deg-purple-deep-purple"></span>
                            <span class="menu-bg-color-option gradient-45deg-deep-orange-orange"
                                  data-color="gradient-45deg-deep-orange-orange"></span>
                            <span class="menu-bg-color-option gradient-45deg-green-teal" data-color="gradient-45deg-green-teal"></span>
                            <span class="menu-bg-color-option gradient-45deg-indigo-light-blue"
                                  data-color="gradient-45deg-indigo-light-blue"></span>
                            <span class="menu-bg-color-option gradient-45deg-red-pink" data-color="gradient-45deg-red-pink"></span>
                        </div>
                        <!--div class="solid-color center-align">
                            <span class="menu-bg-color-option red" data-color="red"></span>
                            <span class="menu-bg-color-option purple" data-color="purple"></span>
                            <span class="menu-bg-color-option pink" data-color="pink"></span>
                            <span class="menu-bg-color-option deep-purple" data-color="deep-purple"></span>
                            <span class="menu-bg-color-option cyan" data-color="cyan"></span>
                            <span class="menu-bg-color-option teal" data-color="teal"></span>
                            <span class="menu-bg-color-option light-blue" data-color="light-blue"></span>
                            <span class="menu-bg-color-option amber darken-3" data-color="amber darken-3"></span>
                            <span class="menu-bg-color-option brown darken-2" data-color="brown darken-2"></span>
                        </div>-->
                    </div>
                    <!--<div class="input-field col s12">
                        <div class="switch">
                            Collapse Menu
                            <label class="float-right">
                                <input class="menu-collapsed-checkbox" type="checkbox" /> <span class="lever ml-0"></span>
                            </label>
                        </div>
                    </div>-->
                </div>

                <hr class="customize-devider" />
                <div class="navbar-options row">
                    <div class="input-field col s12 navbar-color mb-0">
                        <p class="mt-0">Chat Area Background</p>
                        <div class="gradient-color center-align">
                            <span class="navbar-color-option bg-image-shattered" data-color="bg-image-shattered" id="bg-image-shattered"></span>
                            <span class="navbar-color-option bg-image-gradient-squares" data-color="bg-image-gradient-squares" id="bg-image-gradient-squares"></span>
                            <span class="navbar-color-option bg-image-arches" data-color="bg-image-arches" id="bg-image-arches"></span>
                            <span class="navbar-color-option bg-image-brick-wall-dark" data-color="bg-image-brick-wall-dark" id="bg-image-brick-wall-dark"></span>
                            <span class="navbar-color-option bg-image-foggy-birds" data-color="bg-image-foggy-birds" id="bg-image-foggy-birds"></span>
                            <span class="navbar-color-option bg-image-swirl" data-color="bg-image-swirl" id="bg-image-swirl"></span>
                            <span class="navbar-color-option bg-image-hexellence" data-color="bg-image-hexellence" id="bg-image-hexellence"></span>
                            <span class="navbar-color-option bg-image-inspiration-geometry" data-color="bg-image-inspiration-geometry" id="bg-image-inspiration-geometry"></span>
                            <span class="navbar-color-option bg-image-flowers" data-color="bg-image-flowers" id="bg-image-flowers"></span>

                            <span class="navbar-color-option bg-image-light-wool" data-color="bg-image-light-wool" id="bg-image-light-wool"></span>
                            <span class="navbar-color-option bg-image-gray-floral" data-color="bg-image-gray-floral" id="bg-image-gray-floral"></span>
                            <span class="navbar-color-option bg-image-beige-paper" data-color="bg-image-beige-paper" id="bg-image-beige-paper"></span>
                            <span class="navbar-color-option bg-image-padded-light" data-color="bg-image-padded-light" id="bg-image-padded-light"></span>
                            <span class="navbar-color-option bg-image-pool-table" data-color="bg-image-pool-table" id="bg-image-pool-table"></span>
                            <span class="navbar-color-option bg-image-skulls" data-color="bg-image-skulls" id="bg-image-skulls"></span>
                            <span class="navbar-color-option bg-image-xv" data-color="bg-image-xv" id="bg-image-xv"></span>
                            <span class="navbar-color-option bg-image-type" data-color="bg-image-type" id="bg-image-type"></span>
                            <span class="navbar-color-option bg-image-purty-wood" data-color="bg-image-purty-wood" id="bg-image-purty-wood"></span>
                        </div>
                    </div>
                </div>
                <hr class="customize-devider" />
                <div class="input-field col s12">
                    <div class="switch">
                        Dark Mode
                        <label class="float-right">
                            <input class="menu-dark-checkbox" type="checkbox"
                                   {% if settings.mode=='true' %} checked{% endif %} /> <span class="lever ml-0"></span>
                        </label>
                    </div>
                </div>
                <div class="input-field col s12">
                    <div class="switch">
                        <p class="mt-0">Menu Type</p>
                        <label>
                            <input class="menu-selection-radio with-gap"
                                   value="sidenav-active-square"
                                   name="menu-selection"
                                   type="radio"
                                   {% if settings.menu=='sidenav-active-square' %}checked{% endif %} />
                            <span>Square</span>
                        </label>
                        <label>
                            <input class="menu-selection-radio with-gap"
                                   value="sidenav-active-rounded"
                                   name="menu-selection"
                                   type="radio"
                                   {% if settings.menu=='sidenav-active-rounded' %}checked{% endif %} />
                            <span>Rounded</span>
                        </label>
                        <label>
                            <input class="menu-selection-radio with-gap" value="none" name="menu-selection" type="radio"
                                   {% if settings.menu=='none' %}checked{% endif %} />
                            <span>Normal</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/ Theme Customizer -->
    <!-- Modal Structure -->
    <div id="friend-request-modal" class="modal">
        <div class="modal-content">
            <h5>Friend Request</h5>
            <h6 class="black-text"></h6>
        </div>
        <div class="modal-footer">
            <a href="#!" id="friend-accept" class="modal-close waves-effect waves-blue btn-flat blue lighten-3 friend-accept">Accept</a>
            <a href="#!" class="modal-close waves-effect waves-red btn-flat red lighten-3">Decline</a>
        </div>
    </div>
    <!-- Modal Structure -->
    <div id="suspend-modal" class="modal modal-fixed-footer">
        <form id="suspension-form" onsubmit="return false">
            <div class="modal-content">
                <h5>Suspend User Options by (1) or (2)</h5>
                <div class="row">
                    <div class="col s12">
                        <h6>1) Temporary</h6>
                        <div class="input-field col s6">
                            <input type="text" class="datepicker" id="suspend_date" name="suspend_date" placeholder="">
                            <label for="suspend_date">Select expiration date</label>
                        </div>
                        <div class="input-field col s6">
                            <input type="text" class="timepicker" id="suspend_time" name="suspend_time" placeholder="">
                            <label for="suspend_time">Select expiration time</label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <h6>2) Permanently</h6>
                        <div class="col s12">
                            <label>
                                <input type="checkbox" id="suspend_perma" name="suspend_perma" />
                                <span>Indefinitely</span>
                            </label>
                            <br /><br />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <h6>Comment</h6>
                        <div class="input-field col s12">
                            <textarea id="suspend_comment" name="comment" class="materialize-textarea" placeholder="The WWW (What When Where) of reasoning"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="waves-effect waves-blue btn-flat blue lighten-3" onclick="$(this).closest('form').submit()">Apply</a>
                <a href="#!" class="modal-close waves-effect waves-red btn-flat red lighten-3">Cancel</a>
            </div>
        </form>
    </div>

    <!-- Modal Structure -->
    <div id="manage-channel-modal" class="modal modal-fixed-footer">
        <form id="channels-form" onsubmit="return false">
            <div class="modal-content">
                <h5>Channels Manager</h5>
                <h6 class="black-text"></h6>
                <div class="row">
                    <div class="col s12">
                        <div class="input-field">
                            <i class="material-icons prefix">person</i>
                            <input type="text" name="user" id="person-input" class="autocomplete" autocomplete="off" placeholder="Member First and Last Name" onchange="name_Search()">
                        </div>
                    </div>
                </div>
                <!--<div class="row">
                    <div class="col s12 l12 input-field ">
                        <h6>Members List:</h6>
                        <select class="icons" name="user">
                            <option value="" disabled selected>Select a memer</option>
                            {% for member in members %}
                            <option value="{{member.id}}" data-icon="{{url_for('static', filename='images/avatar/'+member.imgUrl)}}">{{member.fullname}} - {{member.title}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>-->
                <div class="row">
                    <h6>Channel List:</h6>
                    <div id="channel-list">
                        {% for channel in all_channels %}
                        {% if channel.id != 1 %}
                        <div class="col s12">
                            <label>
                                <input type="checkbox" name="channels" id="channel_{{ channel.id }}" value="{{ channel.id }}" />
                                <span class="black-text">{{ channel.name }}</span>
                            </label>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a href="#!" class="waves-effect waves-blue btn-flat blue lighten-3" onclick="$(this).closest('form').submit()">Apply</a>
                <a href="#!" class="modal-close waves-effect waves-red btn-flat red lighten-3">Close</a>
            </div>
        </form>
    </div>

    <!-- END: Footer-->
    <!-- BEGIN JS-->
    <script>
        var socket;
        var max_minutes = 5;
        var current_user = {
            id: {{ current_user.id }},
            fullName: '{{ current_user.fullname }}',
            title: '{{ current_user.title }}',
            myImgUrl: '{{ current_user.imgUrl }}',
            selectedTheme:'{{settings.theme}}'
        }
        var current_person = {
            id: 0,
            fullName: '',
            title: '',
        }
        var roomName = '{{ room }}';
        var lastMsg = 0;
        var online_users = [];
        var allfriends = [];
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@2.12.1/dist/index.min.js"></script>
    <!--<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>-->
    <script src="{{url_for('static', filename='js/vendors.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/plugins.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/search.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/customizer.min.js')}}"></script>
    <script src="{{url_for('static', filename='js/app-chat.min.js')}}"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <!--<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>-->
    <!-- END JS-->
    <script>
        // SocketIO
        var $msgs = $('.chat-area');
        var modals;
        var tempFilename = {
            id: 0,
            name: '',
            html: '',
            url: ''
        };
        var activeChannels = [
            {% for channel in channels %}
                '{{ channel.id }}',
            {% endfor %}
        ]

        document.addEventListener('DOMContentLoaded', function () {
            var elems = document.querySelectorAll('.modal');
            var options = { dismissible: false }
            modals = M.Modal.init(elems, options);

            elems = document.querySelectorAll('.timepicker');
            options = { container: "body" }
            timepicker = M.Timepicker.init(elems, options);
        });

        function htmlEncode(str) {
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        function timeDifference(date1, date2) {
            var seconds = Math.floor((date1 - date2) / 1000);
            var minutes = Math.floor(seconds / 60);
            var hours = Math.floor(minutes / 60);
            var days = Math.floor(hours / 24);
            var minutes_diff = minutes;

            hours = hours - (days * 24);
            minutes = minutes - (days * 24 * 60) - (hours * 60);
            seconds = seconds - (days * 24 * 60 * 60) - (hours * 60 * 60) - (minutes * 60);

            data = {
                days: days,
                hours: hours,
                minutes: minutes,
                seconds: seconds,
                minutes_diff: minutes_diff
            }
            return data;
        }

        function editorCmd(cmd) {
            $('#chat-input').focus();
            switch (cmd) {
                case "underline":
                    document.execCommand('underline', false, '');
                    break;

                case "italic":
                    document.execCommand('italic', false, '');
                    break;

                case "bold":
                    document.execCommand('bold', false, '');
                    break;

                case "strikeThrough":
                    document.execCommand('strikeThrough', false, '');
                    break;
            }
        }

        function enter_chat(a) {
            var e = (a == null) ? $(".message").html() : a;
            var f = ($("#file-upload").val() == '') ? 'text' : 'file';

            if (e != '') {
                if (f == 'file') {
                    e = '<span class="black-text file-load" id="' + tempFilename.name + '">File uploading...</span>'

                    var form = $('#fileUploadForm')[0];
                    var data = new FormData(form);

                    $.ajax({
                        type: "POST",
                        enctype: 'multipart/form-data',
                        url: "/file",
                        data: data,
                        processData: false,
                        contentType: false,
                        cache: false,
                        timeout: 600000,
                        success: function (data) {
                            setTimeout(function () {
                                socket.emit('update_text', {
                                    id: tempFilename.id,
                                    msg: '<a href="static/files/' + tempFilename.url + '" target="_blank" contentEditable=false>' + tempFilename.html + '</a>',
                                    id_name: tempFilename.name
                                });
                            }, 2000);
                        },
                        error: function (e) {
                            console.log("ERROR : ", e);
                        }
                    });
                }
                socket.emit('text', {
                    msg: e,
                    type: f
                });
                $(".message").html("");
                $("#file-upload").val("");
            }
        }

        function onMessage(data) {
            //console.log(data)
            var t = '';
            var msg = '<p' + ((data.visible) ? '>' + data.body.msg : ' class="grey-text text-darken-2">Message deleted by user.');

            if (data.track) {
                tempFilename.id = data.id
            }

            if (current_user.id != data.user_id) {
                t = '<div class="chat animated fadeInDown unselectable" id="m_' + data.id + '"><div class="chat-avatar"><a class="avatar"><img src="/static/images/avatar/' + data.imgUrl + '" class="circle" alt="avatar" /></a></div>' +
                    '<div class="chat-body"><div class="chat-text replied">' + msg + '</p></div></div></div>';
                $("#chat-area").append(t);

            } else if (current_user.id == data.user_id) {
                // check minutes between current time and posted time, expires after 5mins
                var current_time = new Date().getTime();
                var timeDiff = timeDifference(current_time, new Date(data.timestamp + ' UTC'));
                var delete_option = (timeDiff.minutes_diff <= max_minutes) ? '<p class="opt-text blue lighten-4" data-id="' + data.id + '" data-timestamp="' + data.timestamp + '"><a class="material-icons black-text medium" href="#">clear</a></p>' : '';

                t = '<div class="chat chat-right options-button animated fadeInDown" id="m_' + data.id + '"><div class="chat-body"><div class="chat-text line-option">' + msg + '</p>' + delete_option + '</div></div></div>';
                $("#chat-area").append(t);
            }

            scrollToBottom(data.user_id);
            //console.log(data);
        }

        //Prevent line/paragraph breaks in contentEditable
        $('[contenteditable=true]').on('paste', function (e) {
            //strips elements added to the editable tag when pasting
            var $self = $(this);
            setTimeout(function () { $self.html($self.text()); }, 0);
        }).on('keypress', function (e) {
            //ignores enter key
            var code = e.keyCode || e.which;
            return code != 13;
        });

        $('#chat-input').keyup(function (e) {
            var code = e.keyCode || e.which;
            if (code == 13) {
                enter_chat();
            }
        });

        function scrollToBottom(data) {
            $msgs.scrollTop($(".chat-area > .chats").height());
            lastMsg = data
        }

        function updateStatus(id, newStatus, status) {
            // update online status
            $('.member_' + id + ' .avatar-status').removeClass('avatar-off avatar-away avatar-busy avatar-online').addClass("avatar-" + newStatus);
            $('.member_' + id).data('position', status); //setter

            if (status == '3')
                $('#member_' + id).addClass('hide');
            else
                $('#member_' + id).removeClass('hide');
        }

        function updateFriendList() {
            var friends = []
            $.getJSON("/getfriends", function (data) {
                $('#friends_ul li').each(function () {
                    if (data[$(this).data('id')] != 1) {
                        $(this).addClass('hide');
                    } else {
                        $(this).removeClass('hide');
                        friends.push($(this).data('id'));
                    }
                });

                allfriends = friends;
                var friends_online_counter = arrayDiff(allfriends, online_users);

                if (friends_online_counter.length <= 0) {
                    if (!$(".friend-online-counter").hasClass("hide"))
                        $(".friend-online-counter").addClass('hide');
                } else {
                    $(".friend-online-counter").text(friends_online_counter.length).removeClass('hide');
                }
            });
        }

        function updateList(type) {
            $(type).html($(type + ' li').sort(sortLiElements));
        }

        function sortLiElements(a, b) {
            return parseInt($(a).data('position')) - parseInt($(b).data('position'));
        }

        function arrayDiff(arr1, arr2) {
            var ret = [];
            arr1.sort();
            arr2.sort();
            for (var i = 0; i < arr1.length; i += 1) {
                if (arr2.indexOf(arr1[i]) > -1) {
                    ret.push(arr1[i]);
                }
            }
            return ret;
        };

        function displayNotification(msg) {
            M.toast({ html: msg, classes: 'rounded', displayLength: 1500 })
        }

        function name_Search() {
            $input = $('#person-input').val();

            if ($input == '' || $input.split(' ').length != 2) return false;

            $("#channels-form input:checkbox").prop('checked', '');

            $.getJSON("/cm/" + encodeURIComponent($input), function (data) {
                $.each(data, function (key, val) {
                    //console.log()
                    $("#channel_"+val.id).prop('checked','on');
                });
            });
        }

        $(document).ready(function () {
            //var socket = io();
            // Socket IO Stuff
            $('input.autocomplete').autocomplete({
                data: {
                {% for member in members %} 
                "{{member.fullname}}": "{{url_for('static', filename='images/avatar/'+member.imgUrl)}}",
                {% endfor %}
                },
                onAutocomplete: name_Search()
            });

            socket = io.connect('http://' + document.domain + ':' + location.port + '/'); //, {transports: ['websocket']}

            socket.on('connect', function () {
                socket.emit('joined');
            });

            socket.on('disconnect', function () {
                socket.emit('disconnect');
            });

            socket.on('status', updateUserStatus);

            socket.on('message', onMessage);

            function updateUserStatus(data) {
                updateFriendList();

                $.each(data['users'], function (key, value) {
                    updateStatus(value['id'], value['online_status'], value['status'])
                    updateList("#friends_ul");
                    updateList("#members_ul");
                });

                online_users = data.clients;

                if (data.count == 1) {
                    if (!$(".online-counter").hasClass("hide"))
                        $(".online-counter").addClass('hide');
                } else {
                    $(".online-counter").text(data.count - 1).removeClass('hide');
                }
            }
        });
    </script>
    <script>
        var idleTime = 0;
        var idleTouch = 1;
        var noteId = '1';
        var colorsPalette = [
            "#8B4513",
            "#AF6E4D",
            "#FFC0CB",
            "#FFE5CC",
            "#FFAA1D",
            "#FA5B3D",
            "#FF5470",
            "#FF0000",
            "#FF007C",
            "#E936A7",
            "#9C51B6",
            "#5946B2",
            "#2243B6",
            "#5DADEC",
            "#A7F432",
            "#299617",
            "#FFF700",
            "#FFFFFF",
            "#CCCCCC",
            "#000000"
        ];


        function resetClass(e) {
            $(e).removeClass("gradient-45deg-indigo-blue gradient-45deg-purple-deep-orange gradient-45deg-light-blue-cyan gradient-45deg-purple-amber gradient-45deg-purple-deep-purple gradient-45deg-deep-orange-orange gradient-45deg-green-teal gradient-45deg-indigo-light-blue gradient-45deg-red-pink red purple pink deep-purple cyan teal light-blue amber darken-3 brown darken-2 gradient-45deg-indigo-purple gradient-45deg-deep-purple-blue")

            $(e).removeClass("bg-image-arches bg-image-gradient-squares bg-image-brick-wall-dark bg-image-foggy-birds bg-image-swirl bg-image-hexellence bg-image-inspiration-geometry bg-image-shattered bg-image-flowers bg-image-light-wool bg-image-gray-floral bg-image-beige-paper bg-image-padded-light bg-image-pool-table bg-image-skulls bg-image-xv bg-image-type bg-image-purty-wood")
        }

        $(document).ready(function () {
            // Canvas
            var canvas = document.getElementById('whiteboard');
            var colors = document.getElementsByClassName('color');
            var context = canvas.getContext('2d');
            var imgContext = imageCanvas.getContext('2d');
            $('#slide-out-chat').sidenav({ draggable: false })
            var current = {
                type: 'source-over',
                color: 'black',
                size: 2
            };
            var drawing = false;

            socket.on('hide_message', onHideMessage);

            socket.on('updated_text', onUpdatedText);

            socket.on('suspend_broadcast', onSuspendBroadcast);

            socket.on('channels_broadcast', onChannelsBroadcast);

            socket.on('drawing', onDrawingEvent);

            socket.on('fill', onFillEvent);

            socket.on('img', onFillImageEvent);

            socket.on('new', newCanvas);

            socket.on('saved', onSaved);

            socket.on('friend_request', friend_modal);

            socket.on('friend_completed', friend_completed);

            //socket.on('accessRevoked', onRevoke);

            // ----- Detect screen resize
            window.addEventListener('resize', onResize, false);

            //Desktop mouse events
            canvas.addEventListener('mousedown', onMouseDown, false);
            canvas.addEventListener('mouseup', onMouseUp, false);
            canvas.addEventListener('mouseout', onMouseUp, false);
            canvas.addEventListener('mousemove', throttle(onMouseMove, 10), false);

            //Touch support for mobile devices
            canvas.addEventListener('touchstart', onMouseDown, false);
            canvas.addEventListener('touchend', onMouseUp, false);
            canvas.addEventListener('touchcancel', onMouseUp, false);
            canvas.addEventListener('touchmove', throttle(onMouseMove, 10), false);

            // ----- interactive elements

            // select color by get all .color class elements
            $('.change-color').on('click', function () {
                current.color = $(this).css("color");
                if ($('#change-type').text() == 'brush')
                    $('#change-type').css("color", current.color);
                //$(this).addClass("color")
                //if ($('#iconTypeColor').text() == "brush")
                //    $('#iconTypeColor').css("color", current.color);
                //$('.color').removeClass("active");
                //$(this).addClass( "active" );
            });

            // select color
            $('.change-type').on('click', function () {
                console.log($('#change-type').text())
                if ($('#change-type').text() == 'brush') {
                    current.type = 'destination-out';
                    current.size = 50;
                    $('#change-type').text('call_to_action').css('color', '#ffd54f')
                } else {
                    current.type = 'source-over';
                    current.size = 2;
                    $('#change-type').text('brush').css("color", current.color);
                }
            });

            $('.image-new').on('click', function () {
                socket.emit('new', {});
            });

            $('.save').on('click', function () {
                if ($('#post_title').val().length > 0) {
                    saveCanvas();
                }
            });

            $('.refresh').on('click', function () {
                window.location.reload(false);
            });

            // open app in fullscreen
            $('.launch').on('click', function () {
                var fullscreenElement = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement;
                if (fullscreenElement)
                    exitFullscreen();
                else
                    launchIntoFullscreen(document.documentElement);
            });

            $('#file').on('change', function () {
                loadImage();
            });

            $('.fill').on('click', function () {
                idleTime = 0;
                socket.emit('fill', {
                    color: current.color
                });
            });

            function onChannelsBroadcast(data) {
                if (current_user.id == data.id) {
                    displayNotification('Your channels list has been updated')
                    activeChannels = data.channels
                    loadChannels();
                }
            }

            function onSuspendBroadcast(data) {
                if (current_user.id == data.id && data.type) {
                    alert('Your account has been suspended.')
                    window.location.href = '/logout'
                }
            }

            function onUpdatedText(data) {
                $('#' + data.id_name).html(data.msg);
            }

            function friend_modal(data) {
                if (current_user.id != data.friend) return false;

                current_person.id = data.id
                current_person.fullName = data.name
                current_person.title = data.title

                $('#friend-request-modal h6').html('<b>'+data.name+'</b> <i>"'+data.title+'"</i>, would like to add you as friend.')
                modals[0].open();
            }

            function friend_completed(data) {
                if (current_user.id != data.friend && current_user.id != data.id) return false;

                displayNotification('Friend handshake confirmed!')
            }

            function onHideMessage(data) {
                if (data == null) return false;

                $("#m_" + data.id + " p:first-child").text('Message deleted by user.').addClass('grey-text text-darken-2')
                $("#m_" + data.id+" p:nth-child(2)").addClass('hide')
            }

            function newCanvas() {
                context.clearRect(0, 0, canvas.width, canvas.height);
                imgContext.clearRect(0, 0, canvas.width, canvas.height);
            }

            // Draw functions
            function drawLine(x0, y0, x1, y1, color, size, type, emit) {
                context.globalCompositeOperation = type;
                context.beginPath();
                context.lineWidth = size;
                context.lineJoin = context.lineCap = 'round';
                context.strokeStyle = color;

                context.moveTo(x0, y0);
                context.lineTo(x1, y1);
                context.stroke();

                context.moveTo(x0 - 2, y0 - 2);
                context.lineTo(x1 - 2, y1 - 2);
                context.stroke();

                context.moveTo(x0 - 1, y0 - 1);
                context.lineTo(x1 - 1, y1 - 1);
                context.stroke();

                context.moveTo(x0 + 2, y0 + 2);
                context.lineTo(x1 + 2, y1 + 2);
                context.stroke();

                context.moveTo(x0 + 1, y0 + 1);
                context.lineTo(x1 + 1, y1 + 1);
                context.stroke();
                context.closePath();

                if (!emit) { return; }

                var w = canvas.width;
                var h = canvas.height;

                emitData = [
                    (x0 / w).toFixed(4),
                    (y0 / h).toFixed(4),
                    (x1 / w).toFixed(4),
                    (y1 / h).toFixed(4),
                    color,
                    size,
                    type
                ];
                socket.emit('drawing', emitData);
            }

            function onMouseDown(e) {
                drawing = true;
                current.x = getInputX(e);
                current.y = getInputY(e);
            }

            function onMouseUp(e) {
                if (!drawing) { return; }
                drawing = false;
                drawLine(current.x, current.y, getInputX(e), getInputY(e), current.color, current.size, current.type, true);
                idleTouch = 1;
                //runOCRAD();
            }

            function onMouseMove(e) {
                if (!drawing) { return; }
                drawLine(current.x, current.y, getInputX(e), getInputY(e), current.color, current.size, current.type, true);
                current.x = getInputX(e);
                current.y = getInputY(e);
            }

            function getInputX(e) {
                return e.clientX || e.changedTouches[0].clientX || e.touches[0].clientX;
            }

            function getInputY(e) {
                return e.clientY || e.changedTouches[0].clientY || e.touches[0].clientY;
            }

            // limit the number of events per second
            function throttle(callback, delay) {
                var previousCall = new Date().getTime();
                return function () {
                    var time = new Date().getTime();

                    if ((time - previousCall) >= delay) {
                        previousCall = time;
                        callback.apply(null, arguments);
                    }
                };
            }

            function onDrawingEvent(data) {
                var w = canvas.width;
                var h = canvas.height;
                drawLine(data[0] * w, data[1] * h, data[2] * w, data[3] * h, data[4], data[5], data[6], false);
            }

            function onFillEvent(data) {
                context.fillStyle = data.color;
                context.fillRect(0, 0, canvas.width, canvas.height);
            }

            function onFillImageEvent(img, callback) {
                var image = new Image();

                image.onload = function () {
                    imgContext.drawImage(image, 0, 0, canvas.width, canvas.height);
                    //$('#loading').fadeOut();
                    if (typeof callback === 'function') callback();
                }

                image.src = img;
            }

            // make the canvas fill its parent
            function onResize(callback) {
                //$('#loading').show();

                canvas.width = $('#slide-out-chat').width();
                canvas.height = $('#slide-out-chat').height();
                imageCanvas.width = $('#slide-out-chat').width();
                imageCanvas.height = $('#slide-out-chat').height();

                // Redraw canvas if resize or newly loaded
                $.get('/img?r=' + roomName, function (d) {
                    //$('#loading').show();
                    data = d[roomName];

                    if (data == null) return;


                    // Load Image First
                    if (data['i'] != null) {
                        onFillImageEvent(data['i'], function () { loadAsynchronous(data) });

                        // if no images, load all layers
                    } else {
                        loadAsynchronous(data);
                    }
                    //$('#loading').fadeOut();
                });
            }

            function loadAsynchronous(data) {
                // Layer d (draw lines)
                if (typeof data['d'] === 'object') {
                    // loop thru all of the layers
                    for (j = 0; j < data['d'].length; j++) {
                        varJDeferred = $.Deferred();
                        //console.log(data['d'][j])

                        // layer is string = Image (base64) or Fill Background color
                        if (typeof data['d'][j] === 'string') {
                            // color fill background data
                            if (data['d'][j].length < 10) {
                                onFillEvent({ 'color': data['d'][j] });
                                varJDeferred.resolve();
                            }
                            // layer is object and is coordinates for the canvas to draw
                        } else {
                            onDrawingEvent(data['d'][j]);
                            varJDeferred.resolve();
                        }
                    }
                }
            } //*/

            // Save Canvas (create thumbnail)
            var nloaded = 0;
            var image1 = new Image,
                image2 = new Image;

            function saveCanvas() {
                //$('#loading').show();
                image1.onload = checkload;
                image1.src = imageCanvas.toDataURL();

                image2.onload = checkload;
                image2.src = canvas.toDataURL();
            }

            function checkload(event) {
                nloaded++;
                if (nloaded < 2) {
                    return;
                }

                var tempCanvas = document.createElement("canvas");
                var tempContext = tempCanvas.getContext('2d');
                var width = (512 > image1.width) ? image1.width : 512;
                var height = Math.round(width / image1.width * image1.height);
                tempCanvas.width = width;
                tempCanvas.height = height;
                tempContext.drawImage(image1, 0, 0, width, height);
                tempContext.drawImage(image2, 0, 0, width, height);

                socket.emit('save', {
                    'id': noteId,
                    'title': $('#post_title').val(),
                    'tags': $('#post_tags').val(),
                    'DataURL': '<div class="card-image"><img src="' + tempCanvas.toDataURL() + '"></div>'
                }); //*/

                nloaded = 0;
            }

            function onSaved(data) {
                msg = data ? "Saved!" : "Error: unable to save, please try again later";

                displayNotification(msg)

                if (noteId == '')
                    window.location.reload()
                else
                    $('#loading').fadeOut();
            }

            // Load Image
            function loadImage() {
                // $('#loading').fadeIn();
                var tempCanvas = document.createElement("canvas"),
                    tempContext = tempCanvas.getContext('2d');
                tempCanvas.width = $('#slide-out-chat').width();
                tempCanvas.height = $('#slide-out-chat').height();

                var file = $('#file')[0].files[0]

                var reader = new FileReader();

                reader.onload = function () {
                    var img = new Image();

                    img.onload = function () {
                        tempContext.drawImage(img, 0, 0, tempCanvas.width, tempCanvas.height);
                        socket.emit('img', tempCanvas.toDataURL());
                    };

                    img.src = reader.result;
                };

                if (file) {
                    reader.readAsDataURL(file);
                }
            }

            function launchIntoFullscreen(element) {
                if (element.requestFullscreen) {
                    element.requestFullscreen();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                }
            }

            function exitFullscreen() {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }
            }

            /*function onRevoke() {
                {-% if post.owner == False %-}
                //Desktop mouse events
                canvas.removeEventListener('mousedown', onMouseDown, false);
                canvas.removeEventListener('mouseup', onMouseUp, false);
                canvas.removeEventListener('mouseout', onMouseUp, false);
                canvas.removeEventListener('mousemove', throttle(onMouseMove, 10), false);

                //Touch support for mobile devices
                canvas.removeEventListener('touchstart', onMouseDown, false);
                canvas.removeEventListener('touchend', onMouseUp, false);
                canvas.removeEventListener('touchcancel', onMouseUp, false);
                canvas.removeEventListener('touchmove', throttle(onMouseMove, 10), false);

                $('#TB_menu').hide();
                $('#TB_colors').hide();
                M.toast({html: 'The owner of this note has revoke collaborators editing access'})

                {-% endif %-}
            }*/

            function init() {
                // Theme init
                //$('#iconTypeColor').css("color", current.color);
                $(".navbar-main").addClass('{{settings.theme}}')
                $(".content-wrapper-before").addClass('{{settings.theme}}')
                $(".sidenav-main .sidenav li a.active").addClass('{{settings.theme}}')
                $(".sidenav-main").removeClass("sidenav-active-square sidenav-active-rounded").addClass('{{settings.menu}}')
                $(".chat-area").addClass('{{settings.chatarea}}')
                $("#{{settings.chatarea}}").addClass('selected')
                $("#{{settings.theme}}").addClass('selected')

                loadChannels();

                //$('#loading').fadeOut();
                loadChatMessages(roomName)
            }

            function loadChannels() {
                $('.channel-item').each(function (key, val) {
                    channel_id = $(this).attr('data-id')
                    if (activeChannels.indexOf(channel_id) >= 0)
                        $(this).removeClass('hide')
                    else
                        if (channel_id != 1)
                            $(this).addClass('hide')
                });
            }

            function loadChatMessages(b64name) {
                $.getJSON("/gm/" + b64name, function (data) {
                    $.each(data, function (key, val) {
                        onMessage(val);
                    });
                });

                $.getJSON("/channel/" + b64name, function (data) {
                    if (data.type > 0 && allfriends.indexOf(data.type))
                        $('#chat-add-friend').removeClass('hide').show().attr("data-id", data.type);
                    else
                        $('#chat-add-friend').removeClass('hide').hide();

                    if (data.type > 0) {
                        $('#chat-options').show();
                        current_person.id = data.type;
                        current_person.fullName = data.name;
                        current_person.title = data.title;
                    }else
                        $('#chat-options').hide();

                    $('#chat-avatar').attr("src", "static/images/avatar/" + data.imgUrl);
                    $('#chat-name').text(data.name);
                    $('#chat-subtext').text(data.title);
                    roomName = b64name;
                    onResize();
                });

                $msgs.scrollTop($(".chat-area > .chats").height());
            }

            var inputs = document.querySelectorAll(".open-chat");
            for (i = 0; i < inputs.length; i++) {
                inputs[i].addEventListener('click', function () {
                    b64name = this.dataset.link;
                    id = this.dataset.id;
                    socket.emit('channel', { b64: b64name, id: id });
                    //$.ajax({ url: "/ch/" + id + "/"+ b64name }).done(function (data) { console.log(data) });
                    $('#chat-area').html('');

                    loadChatMessages(b64name);

                    $('.open-chat').removeClass('active ' + current_user.selectedTheme);
                    resetClass('.sidenav-main .sidenav li a');

                    if (this.dataset.type == "menu") {
                        strs = current_user.selectedTheme.split(" ");
                        for (i = 0; i < strs.length; i++) {
                            this.classList.add(strs[i]);
                        }
                        this.classList.add('active');

                    } else if (this.dataset.target == "slide-out-chat") {
                        $('#sidenav_m' + id).addClass('active ' + current_user.selectedTheme);
                    }
                    //$(this).addClass('active')
                    //$(this).sidenav('close');
                });
            }

            $("#chat-add-friend").click(function () {
                socket.emit('friend', { id: current_user.id, friend: parseInt($(this).attr("data-id")), name: current_user.fullName, title: current_user.title });
                displayNotification('Friend request sent!')
            });

            $("#friend-accept").click(function () {
                socket.emit('friend_accept', { id: current_user.id, friend: current_person.id });
            });

            $("#profile-dropdown li").click(function () {
                type = $(this).attr("data-value");

                $.ajax({
                    url: "/cs/" + type
                }).done(function (data) {
                    socket.emit('update_stats');
                });
            });

            $("#file-upload-tigger").on('click', function (e) {
                document.getElementById("file-upload").click();
            });

            $("#file-upload").on('change', function () {
                var fileInput = document.getElementById('file-upload');
                var file = fileInput.files[0];
                var filename = file.name.split('.');
                var extension = filename.pop()

                var filename = (filename[0].length > 15) ? filename[0].substring(0, 15)+'....'+extension : file.name;
                var html = '<span class="display-flex" class="uploading-file"><span class="display-flex align-item-center flex-grow-1" contentEditable=false><span class="material-icons black-text">insert_drive_file</span><span class="member-info display-flex flex-column"> <span class="black-text">' + filename + '</span> <small class="grey-text text-darken-2">' + fileSize(file.size) + '</small></span></span><i class="material-icons black-text attachment-clear">close</i></span>';

                $("#chat-input").html(html)
                //<span class="black-text file-load">File uploading...</span>
                //$("#chat-input").html('<a href="static/files/'+file.name+'" target="_blank" contentEditable=false><span class="display-flex"><span class="display-flex align-item-center flex-grow-1"><span class="material-icons black-text">insert_drive_file</span><span class="member-info display-flex flex-column"> <span class="black-text">'+file.name+'</span> <small class="grey-text text-darken-2">'+fileSize(file.size)+'</small></span></span></span></a>')
                //$("#chat-input").html('<span contentEditable=false><a href="static/files/'+file.name+'" target="_blank"><i class="small material-icons black-text">insert_drive_file</i> <span class="black-text">'+file.name+'</span><br><small class="grey-text text-darken-2">'+fileSize(file.size)+'</small></a></span>')
                tempFilename.name = new Date().getTime();
                tempFilename.url = file.name
                tempFilename.html = html;
                //console.log(tempFilename.name)
                //console.log(file)
            });

            $("#chat-input").on('click', '.attachment-clear', function (e) {
                e.preventDefault();
                $("#chat-input").text('');
                $("#file-upload").val('');
            });

            function toTimestamp(strDate){
                var datum = Date.parse(strDate);
                return datum;
            }

            function fileSize(fileSizeInBytes) {
                var i = -1;
                var byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];
                do {
                    fileSizeInBytes = fileSizeInBytes / 1024;
                    i++;
                } while (fileSizeInBytes > 1024);

                return Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];
            };

            /*$('.line-option').on("mouseover", function () {
                var current_time = new Date().getTime();
                var posted_time = new Date($(this).children('p').eq(1).attr("data-timestamp")+' UTC');
                data = timeDifference(current_time, posted_time)
                console.log($(this).children('p').eq(0).text())
                if (data.minutes_diff > 10 || $(this).children('p').eq(0).text() == 'Message deleted by user.')
                    $(this).children('p').eq(1).addClass('hide');
            });*/

            $('#chat-area').on("click", ".opt-text", function () {
                var current_time = new Date().getTime();
                var posted_time = new Date($(this).attr("data-timestamp")+' UTC');
                data = timeDifference(current_time, posted_time)

                if (data.minutes_diff <= max_minutes)
                    socket.emit('disable_text', { id: $(this).attr("data-id") });
                else
                    $(this).addClass('hide');
                //console.log('difference = ' + data.days + ' days ' + data.hours + ' hours ' + data.minutes + ' minutes ' + data.seconds + ' seconds');
            });

            $('#suspend-modal').modal({
                dismissible: true, // Modal can be dismissed by clicking outside of the modal
                onOpenEnd: function(modal, trigger) { // Callback for Modal open. Modal and trigger parameters available.
                    $.getJSON("/gsd/" + current_person.id, function (data) {
                        if (data.timestamp) {
                            var date = new Date(data.timestamp + ' UTC')
                            var ampm = date.getHours() >= 12 ? 'PM' : 'AM';
                            $('#suspend_date').val(date.getFullYear() + '-' + (date.getMonth() + 1) + '-' + date.getDate())
                            $('#suspend_time').val(date.getHours() + ':' + date.getMinutes() + ' ' + ampm)
                        }
                        $('#suspend_comment').val(data.comment)
                        $('#suspend_perma').prop(data.permanent)
                    });
                }
            });

            $('#suspension-form').submit(function () {
                //type = $('#suspend_perma').prop('checked')
                //console.log(current_person)
                //socket.emit('suspend_perma', { id: current_person.id, type: type });
                var form = $('#suspension-form')[0];
                var data = new FormData(form);

                timestamp = new Date(data.get('suspend_date') + ' ' + data.get('suspend_time'));
                timestamp = new Date(timestamp.getTime() + timestamp.getTimezoneOffset() * 60000)
                data.append('timestamp', timestamp.getTime() / 1000)

                $.ajax({
                    type: "POST",
                    url: "/sfs/" + current_person.id,
                    data: data,
                    processData: false,
                    contentType: false,
                    cache: false,
                    timeout: 600000,
                    success: function (data) {
                        M.toast({ html: data, classes: 'rounded' });
                        socket.emit('suspend_perma', { id: current_person.id });
                    },
                    error: function (e) {
                        console.log("ERROR : ", e);
                    }
                });
                $('#suspend-modal').modal('close');
            });

            $('#channels-form').submit(function () {
                //type = $('#suspend_perma').prop('checked')
                //console.log(current_person)
                //socket.emit('suspend_perma', { id: current_person.id, type: type });
                var form = $(this)[0];
                var data = new FormData(form);

                console.log(data.get('user'));

                $.ajax({
                    type: "POST",
                    url: "/cfs",
                    data: data,
                    processData: false,
                    contentType: false,
                    cache: false,
                    timeout: 600000,
                    success: function (data) {
                        if (data.id) {
                            displayNotification(data.msg)
                            socket.emit('update_channel', { id: data.id, channels: data.channels });
                        }else
                            displayNotification(data)
                    },
                    error: function (e) {
                        console.log("ERROR : ", e);
                    }
                });
                //$('#suspend-modal').modal('close');
            });

            // init run
            init();
        });
    </script>
</body>
</html >
